---
# YAML Front Matter：文章設定區塊
title: "一鍵整合所有雲端Google sheet表單，一鍵建立資料庫"
description: "在管理上最困難的就是當資料大到超過一個數字，例如55件，每件有100筆資料，每筆資料有10欄內容，並且每件資料都有一些手動輸入的問題，要如何快速檢視並建立資料庫呢？透過Google app script 一鍵完成"
categories: ["vibe coding",'資料分析']   # 這是您的分類，可以自己決定
tags: ["Google app script","Gemini"]           # 這是文章的標籤
---

同事苦惱來訊問要怎麼快速整理55所學校提交的量化資料，由於上頭的壓力大，要趕緊理出頭緒，經查看資料，同事給我的各校資料亂七八糟，要有規則的話可能要找一個人力花兩週的時間一筆筆整理。然後，還要找另一個人力，把整理的資料進行檢核，交叉比對，確認手動合併資料沒有任何錯誤。

這樣的效率非常低，而且容易出錯。我想起了之前在整理問卷批次整理5000筆資料的功能，於是動動AI魔法，寫出了以下的程式碼解決這個問題。

為了方便管理人員檢視資料來源，最後加入可追蹤的來源標題。只花了我20分鐘測試，10分鐘教學，就解決了原本需要2週才可以完成的事情。

---

### 技術筆記：利用 GAS 打造「自動化跨表彙整系統」
在處理多部門或多專案資料時，最困擾的往往是手動複製貼上，這不僅低效，更難以追溯資料來源。透過這段 Google Apps Script (GAS) 腳本，我們可以將 Google Drive 資料夾視為一個「虛擬資料庫」，實現自動化的 ETL（擷取、轉換、載入） 流程。

#### 核心運作邏輯
自動掃描與過濾：腳本透過 DriveApp 鎖定指定資料夾，並精確篩選出所有試算表，排除了非格式化檔案的干擾。

#### 智慧型資料結構化：

1. 首表建立基礎：針對第一個檔案，保留標題列並動態新增「來源檔案名稱」欄位，定義資料格式。

2. 續表去重合併：後續檔案自動跳過首行標題，僅擷取純數據，確保母表結構整潔、不重複。

3. 資料來源追蹤 (Data Lineage)：這是本腳本最關鍵的設計。在每一列資料末端自動注入 fileName，讓合併後的數據具備「可回溯性」，日後分析時能輕易識別該筆資料來自哪個原始檔案。

4. 高效能寫入：採用「先存陣列，後批次寫入」的策略（使用 setValues），大幅減少與伺服器的連線次數，提升處理大量資料時的穩定性。

#### 為什麼這段 Code 值得紀錄？
這不僅是程式碼，更是一套自動化辦公方案。它解決了跨表整合時最常見的三大痛點：格式統一、欄位對齊、來源標記。對於初學者而言，這是學習如何操控 Range 物件與 SpreadsheetApp 的最佳實戰範例；對於進階用戶，則能以此為基礎，延伸出定時排程執行或自動化報表分析系統。

```javascript
function combineFolderSheetsWithFileName() {
  const folderId = '這是id'; // 請替換成你的資料夾 ID
  const targetSheet = SpreadsheetApp.getActiveSpreadsheet().getActiveSheet();
  const folder = DriveApp.getFolderById(folderId);
  const files = folder.getFilesByType(MimeType.GOOGLE_SHEETS);
  
  targetSheet.clear();
  
  let isFirstFile = true;

  while (files.hasNext()) {
    const file = files.next();
    const fileName = file.getName(); // 取得檔案名稱
    const spreadsheet = SpreadsheetApp.openById(file.getId());
    const sourceSheet = spreadsheet.getSheets()[0];
    
    const lastRow = sourceSheet.getLastRow();
    const lastColumn = sourceSheet.getLastColumn();
    
    if (lastRow < 1) continue;

    let data;
    if (isFirstFile) {
      // 第一個檔案：抓取標題 + 資料
      data = sourceSheet.getRange(1, 1, lastRow, lastColumn).getValues();
      
      // 在標題列最後一欄加上「來源檔案」字樣
      data[0].push("來源檔案名稱");
      
      // 為其餘資料列加上檔案名稱
      for (let i = 1; i < data.length; i++) {
        data[i].push(fileName);
      }
      isFirstFile = false;
    } else {
      if (lastRow <= 1) continue;
      // 後續檔案：只抓取資料列
      data = sourceSheet.getRange(2, 1, lastRow - 1, lastColumn).getValues();
      
      // 為每一列資料加上檔案名稱
      for (let i = 0; i < data.length; i++) {
        data[i].push(fileName);
      }
    }

    // 寫入母表
    const destLastRow = targetSheet.getLastRow();
    targetSheet.getRange(destLastRow + 1, 1, data.length, data[0].length).setValues(data);
    
    console.log(`已完成：${fileName}，寫入 ${data.length} 列。`);
  }
  
  SpreadsheetApp.getUi().alert('含檔案名稱的資料彙整已完成！');
}
```
